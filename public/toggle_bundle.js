(()=>{"use strict";function e(e){return`http://www.hansungpocs.site:80/${e}`}const t=e("api/auth/validation"),o=e("api/auth/logout"),n=document.getElementById("toggle"),l=localStorage.getItem("sessionToken"),a=document.getElementById("toggleDetail"),i=(document.getElementById("navItem"),document.getElementById("adminBtn")),s=localStorage.getItem("userId"),d=document.querySelector(".navbar .container .nav-item a img");let c=localStorage.getItem("userType");const r=document.querySelector(".nav-item img");async function m(o){const n={method:"POST",headers:{"Content-Type":"application/json","x-pocs-session-token":o}},l=await fetch(t,n),a=await l.json();return console.log(a),200===a.status?(console.log(a.data.user),"anonymous"!=a.data.user.type&&(null!=a.data.user.defaultInfo.userProfilePath?r.src=e(`${a.data.user.defaultInfo.userProfilePath}`):r.src="../img/logo.png"),a.data.user):(console.log(a.message),!1)}function u(e){a.innerHTML="loginFirst"===e?'<li><a class="dropdown-item" href="../html/index.html">로그인</a></li>':"anonymous"===c?'\n            <li><a class="dropdown-item" href="#" onclick="handleLogout()">로그아웃</a></li>\n        ':`\n            <li><a class="dropdown-item" href="../html/user_detail_edit.html?userId=${e}">내 정보 수정</a></li>\n            <li><a class="dropdown-item" href="#" onclick="handleLogout()">로그아웃</a></li>\n        `}window.location.href.includes("index")||null===l&&(console.log("ok"),window.location.href="./index.html"),window.moveMainPage=function(e){window.location.href="./main.html"},window.moveNoticePage=function(e){window.location.href="../html/notices.html"},window.movePostPage=function(e){window.location.href=`../html/posts.html?category=${e}`},window.moveUserPage=function(){null===c||"anonymous"===c?confirm("블로그 회원만 조회 가능합니다.\n로그인하시겠습니까?")&&(window.location.href="../html/index.html"):window.location.href="../html/user.html"},window.handleLogout=async function(e){const t={method:"POST",headers:{"Content-Type":"application/json","x-pocs-session-token":l}},n=await fetch(o,t),a=await n.json();console.log(a),200===a.status?(localStorage.removeItem("sessionToken"),localStorage.removeItem("userId"),localStorage.removeItem("userType"),window.location.href="./index.html",alert("로그아웃 되었습니다.")):console.log(a.message)},window.location.href.includes("index")||(window.addEventListener("load",(async function(){if(null!=l){let e=await m(l);"admin"===e.type&&(i.classList.toggle("hidden"),null!=window.location.href.match("notices.html")?document.getElementById("noticeAddBtn").classList.toggle("hidden"):null!=window.location.href.match("notices_detail.html")&&document.getElementById("noticeEditBtn").classList.toggle("hidden")),null!=window.location.href.match("main")?"admin"!==e.type&&"member"!==e.type||document.getElementById("userList").classList.toggle("hidden"):null==window.location.href.match("qa_add")&&null==window.location.href.match("qa_detail_edit")||"anonymous"==e.type||document.getElementById("title-below-area").classList.toggle("hidden"),null!=e.defaultInfo.userProfilePath&&(d.src=`http://34.64.161.55:80${e.defaultInfo.userProfilePath}`)}})),n.addEventListener("click",(async function(e){if(e.preventDefault(),n.classList.contains("show"))if(null!=l){let e=await m(l);null!=e.userId?u(e.userId):console.log("유효하지 않은 토큰입니다.")}else u("loginFirst")})),window.addEventListener("storage",(()=>{alert("userId값은 변경될수 없습니다!"),localStorage.removeItem("userId"),localStorage.setItem("userId",s)})))})();