(()=>{const e=window.location.href.split("?userId=")[1],t=new URL("http://34.64.170.244:80/api/users/"+e);let o=localStorage.getItem("sessionToken"),a=new Headers({"x-pocs-session-token":o});const l=document.querySelector("#user_detail_edit_title"),n=(document.querySelector("#user_detail_edit_saveBtn"),document.querySelector("#user_detail_edit_cancelBtn"),document.querySelector("#user_detail_edit_userName")),s=document.querySelector("#user_detail_edit_password"),d=document.querySelector("#user_detail_edit_email"),i=document.querySelector("#user_detail_edit_studentId"),u=document.querySelector("#user_detail_edit_generation"),r=document.querySelector("#user_detail_edit_company"),c=document.querySelector("#user_detail_edit_github"),f=document.querySelector("#editForm"),m=document.getElementById("chooseFile"),g=document.getElementById("profileImage"),p=document.getElementById("basicProfileBtn");let _=!1;window.cancelFile=function(){document.getElementById("profileImage").src="../img/logo.png",m.value=null,console.log(m),p.classList.add("disabled"),_=!0},window.loadFile=function(e){var t=e.files[0];if(console.log(t),t.size>10485760)return alert("이미지 사이즈는 10MB 이내로 가능합니다."),void(m.value=null);let o=t.name.lastIndexOf("."),a=t.name.substr(o);if(".jpg"!==a&&".jpeg"!==a&&".png"!==a)return alert(".jpg, .jpeg, .png 파일만 등록 가능합니다."),void(m.value=null);var l=document.getElementById("profileImage");l.setAttribute("class","img"),l.src=URL.createObjectURL(t),console.log(l.src),l.style.width="200px",l.style.height="200px",p.classList.remove("disabled"),_=!0},document.querySelector("#user_detail_edit_img");const h=document.querySelector("#user_detail_edit_img_input");document.querySelector("#user_detail_edit_img_preview"),document.querySelector("#user_detail_edit_img_2basic"),console.log(o),fetch(t,{headers:a}).then((e=>e.json())).then((e=>{console.log(e),403===e.status?(l.innerHTML=`${e.message}`,f.classList.add("hidden")):(l.innerHTML=`\n                ${e.data.defaultInfo.name}님의 정보 수정\n            `,n.value=`${e.data.defaultInfo.name}`,d.value=`${e.data.defaultInfo.email}`,i.innerHTML=`${e.data.defaultInfo.studentId}`,u.innerHTML=`${e.data.defaultInfo.generation}`,"-"==e.data.defaultInfo.company||"undefined"==e.data.defaultInfo.company||null==e.data.defaultInfo.company?r.value="":r.value=`${e.data.defaultInfo.company}`,"-"==e.data.defaultInfo.github||"undefined"==e.data.defaultInfo.github||null==e.data.defaultInfo.github?c.value="":c.value=`${e.data.defaultInfo.github}`,null===e.data.defaultInfo.userProfilePath?g.src="../img/logo.png":(console.log(e.data.defaultInfo.userProfilePath),g.src=`http://34.64.170.244:80${e.data.defaultInfo.userProfilePath}`,p.classList.remove("disabled")))})),f.addEventListener("submit",(async function(t){t.preventDefault(),console.log("edit");let a,l=new FormData;if(null==h.files[0])l=null;else{if(h.files.length>1)return void alert("1개의 이미지만 선택해주세요.");if(a=h.files[0],!a.type.match("image/.*"))return void alert("jpg나 png 파일이 아닙니다.");if(a.size>1e6)return void alert("이미지의 크기가 10mb 이상입니다. ");l.append("image",h.files[0]),console.log("append")}const i={password:s.value,name:n.value,email:d.value,github:c.value,company:r.value},u={method:"PATCH",headers:{"Content-Type":"application/json","x-pocs-session-token":o},body:JSON.stringify(i)},f=await fetch(`http://34.64.170.244:80/api/users/${e}`,u),g=await f.json();if(null!=l){const t={method:"PATCH",headers:{"x-pocs-session-token":sessionToken},body:l};console.log(t);const o=await fetch(`http://34.64.170.244:80/api/users/${e}/profile`,t),a=await o.json();console.log(a,o)}let p=new FormData;p.append("image",m.files[0]),console.log(m.files[0]);const y={method:"PATCH",headers:{"x-pocs-session-token":o},body:p};if(!0===_){const t=await fetch(`http://34.64.170.244:80/api/users/${e}/profile`,y),o=await t.json();console.log(o)}302!==g.status||console.log(g.message),window.location.href="../html/user_detail.html?userId="+e}))})();