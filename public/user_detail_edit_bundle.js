(()=>{const e=window.location.href.split("?userId=")[1],t=new URL("http://34.64.170.244:80/api/users/"+e);let a=localStorage.getItem("sessionToken"),o=new Headers({"x-pocs-session-token":a});const l=document.querySelector("#user_detail_edit_title"),n=(document.querySelector("#user_detail_edit_saveBtn"),document.querySelector("#user_detail_edit_cancelBtn")),d=document.querySelector("#user_detail_edit_userName"),i=document.querySelector("#user_detail_edit_password"),s=document.querySelector("#user_detail_edit_email"),u=document.querySelector("#user_detail_edit_studentId"),r=document.querySelector("#user_detail_edit_generation"),c=document.querySelector("#user_detail_edit_company"),m=document.querySelector("#user_detail_edit_github"),f=document.querySelector("#editForm"),g=document.getElementById("chooseFile"),_=document.getElementById("profileImage"),p=document.getElementById("basicProfileBtn");let h=!1;window.cancelFile=function(){document.getElementById("profileImage").src="../img/logo.png",g.value=null,console.log(g),p.classList.add("disabled"),h=!0},window.loadFile=function(e){var t=e.files[0];if(console.log(t),t.size>10485760)return alert("이미지 사이즈는 10MB 이내로 가능합니다."),void(g.value=null);let a=t.name.lastIndexOf("."),o=t.name.substr(a);if(".jpg"!==o&&".jpeg"!==o&&".png"!==o)return alert(".jpg, .jpeg, .png 파일만 등록 가능합니다."),void(g.value=null);var l=document.getElementById("profileImage");l.setAttribute("class","img"),l.src=URL.createObjectURL(t),console.log(l.src),l.style.width="200px",l.style.height="200px",p.classList.remove("disabled"),h=!0},document.querySelector("#user_detail_edit_img"),document.querySelector("#user_detail_edit_img_input"),document.querySelector("#user_detail_edit_img_preview"),document.querySelector("#user_detail_edit_img_2basic"),console.log(a),fetch(t,{headers:o}).then((e=>e.json())).then((e=>{console.log(e),403===e.status?(l.innerHTML=`${e.message}`,f.classList.add("hidden")):(l.innerHTML=`\n                ${e.data.defaultInfo.name}님의 정보 수정\n            `,d.value=`${e.data.defaultInfo.name}`,s.value=`${e.data.defaultInfo.email}`,u.innerHTML=`${e.data.defaultInfo.studentId}`,r.innerHTML=`${e.data.defaultInfo.generation}`,"-"==e.data.defaultInfo.company||"undefined"==e.data.defaultInfo.company||null==e.data.defaultInfo.company?c.value="":c.value=`${e.data.defaultInfo.company}`,"-"==e.data.defaultInfo.github||"undefined"==e.data.defaultInfo.github||null==e.data.defaultInfo.github?m.value="":m.value=`${e.data.defaultInfo.github}`,null===e.data.defaultInfo.userProfilePath?_.src="../img/logo.png":(console.log(e.data.defaultInfo.userProfilePath),_.src=`http://34.64.170.244:80${e.data.defaultInfo.userProfilePath}`,p.classList.remove("disabled")))})),f.addEventListener("submit",(async function(t){t.preventDefault(),console.log("edit");const o={password:i.value,name:d.value,email:s.value,github:m.value,company:c.value},l={method:"PATCH",headers:{"Content-Type":"application/json","x-pocs-session-token":a},body:JSON.stringify(o)},n=await fetch(`http://34.64.170.244:80/api/users/${e}`,l),u=await n.json();let r=new FormData;r.append("image",g.files[0]),console.log(g.files[0]);const f={method:"PATCH",headers:{"x-pocs-session-token":a},body:r};if(!0===h){const t=await fetch(`http://34.64.170.244:80/api/users/${e}/profile`,f),a=await t.json();console.log(a)}302!==u.status||console.log(u.message),window.location.href="../html/user_detail.html?userId="+e})),n.addEventListener("click",(function(t){t.preventDefault(),window.location.href="../html/user_detail.html?userId="+e}))})();