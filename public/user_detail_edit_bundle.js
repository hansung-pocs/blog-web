(()=>{"use strict";function e(e){return`https://hansungpocs.site/${e}`}const t=window.location.href.split("?userId=")[1];let a=localStorage.getItem("sessionToken"),n=new Headers({"x-pocs-session-token":a});const o=document.querySelector("#user_detail_edit_title"),l=(document.querySelector("#user_detail_edit_saveBtn"),document.querySelector("#user_detail_edit_cancelBtn")),d=document.querySelector("#user_detail_edit_userName"),s=document.querySelector("#user_detail_edit_password"),u=document.querySelector("#user_detail_edit_email"),i=document.querySelector("#user_detail_edit_studentId"),r=document.querySelector("#user_detail_edit_generation"),c=document.querySelector("#user_detail_edit_company"),f=document.querySelector("#user_detail_edit_github"),m=document.querySelector("#editForm"),g=document.getElementById("chooseFile"),p=document.getElementById("profileImage"),h=document.getElementById("basicProfileBtn");let _=!1;window.cancelFile=function(){document.getElementById("profileImage").src="../img/logo.png",g.value=null,console.log(g),h.classList.add("disabled"),_=!0},window.loadFile=function(e){var t=e.files[0];if(console.log(t),t.size>10485760)return alert("이미지 사이즈는 10MB 이내로 가능합니다."),void(g.value=null);let a=t.name.lastIndexOf("."),n=t.name.substr(a);if(".jpg"!==n&&".jpeg"!==n&&".png"!==n)return alert(".jpg, .jpeg, .png 파일만 등록 가능합니다."),void(g.value=null);var o=document.getElementById("profileImage");o.setAttribute("class","img"),o.src=URL.createObjectURL(t),console.log(o.src),o.style.width="200px",o.style.height="200px",h.classList.remove("disabled"),_=!0},console.log(a),fetch(e(`api/users/${t}`),{headers:n}).then((e=>e.json())).then((t=>{console.log(t),403===t.status?(o.innerHTML=`${t.message}`,m.classList.add("hidden")):(o.innerHTML=`\n                ${t.data.defaultInfo.name}님의 정보 수정\n            `,d.value=`${t.data.defaultInfo.name}`,u.value=`${t.data.defaultInfo.email}`,i.innerHTML=`${t.data.defaultInfo.studentId}`,r.innerHTML=`${t.data.defaultInfo.generation}`,"-"==t.data.defaultInfo.company||"undefined"==t.data.defaultInfo.company||null==t.data.defaultInfo.company?c.value="":c.value=`${t.data.defaultInfo.company}`,"-"==t.data.defaultInfo.github||"undefined"==t.data.defaultInfo.github||null==t.data.defaultInfo.github?f.value="":f.value=`${t.data.defaultInfo.github}`,null===t.data.defaultInfo.userProfilePath?p.src="../img/logo.png":(console.log(t.data.defaultInfo.userProfilePath),p.src=`${e(t.data.defaultInfo.userProfilePath)}`,h.classList.remove("disabled")))})),m.addEventListener("submit",(async function(n){n.preventDefault(),console.log("edit");const o={password:s.value,name:d.value,email:u.value,github:f.value,company:c.value},l={method:"PATCH",headers:{"Content-Type":"application/json","x-pocs-session-token":a},body:JSON.stringify(o)},i=await fetch(e(`api/users/${t}`),l),r=await i.json();let m=new FormData;m.append("image",g.files[0]);const p={method:"PATCH",headers:{"x-pocs-session-token":a},body:m};!0===_&&await fetch(e(`api/users/${t}/profile`),p).then((e=>e.json)).then((e=>console.log(e))).catch((e=>console.log(e))),302!==r.status||console.log(r.message),window.location.href="./user_detail.html?userId="+t})),l.addEventListener("click",(function(e){e.preventDefault(),window.location.href="./user_detail.html?userId="+t}))})();