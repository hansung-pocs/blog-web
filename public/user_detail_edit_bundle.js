(()=>{const e=window.location.href.split("?userId=")[1],t=new URL("http://34.64.170.244:80/api/users/"+e);let a=localStorage.getItem("sessionToken"),n=new Headers({"x-pocs-session-token":a});const o=document.querySelector("#user_detail_edit_title"),l=(document.querySelector("#user_detail_edit_saveBtn"),document.querySelector("#user_detail_edit_cancelBtn")),d=document.querySelector("#user_detail_edit_userName"),i=document.querySelector("#user_detail_edit_password"),s=document.querySelector("#user_detail_edit_email"),u=document.querySelector("#user_detail_edit_studentId"),r=document.querySelector("#user_detail_edit_generation"),c=document.querySelector("#user_detail_edit_company"),f=document.querySelector("#user_detail_edit_github"),m=document.querySelector("#editForm"),g=document.getElementById("chooseFile"),_=document.getElementById("profileImage"),p=document.getElementById("basicProfileBtn");const h=document.querySelector("#user_detail_edit_img"),y=document.querySelector("#user_detail_edit_img_input"),I=document.querySelector("#user_detail_edit_img_preview"),v=document.querySelector("#user_detail_edit_img_2basic");let w=!1;console.log(a),fetch(t,{headers:n}).then((e=>e.json())).then((e=>{console.log(e),403===e.status?(o.innerHTML=`${e.message}`,m.classList.add("hidden")):(o.innerHTML=`\n                ${e.data.defaultInfo.name}님의 정보 수정\n            `,d.value=`${e.data.defaultInfo.name}`,s.value=`${e.data.defaultInfo.email}`,u.innerHTML=`${e.data.defaultInfo.studentId}`,r.innerHTML=`${e.data.defaultInfo.generation}`,null!=e.data.defaultInfo.userProfilePath?(I.src=`http://34.64.170.244${e.data.defaultInfo.userProfilePath}`,h.src=`http://34.64.170.244"${e.data.defaultInfo.userProfilePath}`):(I.src="../img/logo.png",h.src="../img/logo.png"),"-"==e.data.defaultInfo.company||"undefined"==e.data.defaultInfo.company||null==e.data.defaultInfo.company?c.value="":c.value=`${e.data.defaultInfo.company}`,"-"==e.data.defaultInfo.github||"undefined"==e.data.defaultInfo.github||null==e.data.defaultInfo.github?f.value="":f.value=`${e.data.defaultInfo.github}`,null===e.data.defaultInfo.userProfilePath?_.src="../img/logo.png":(_.src=`http://34.64.170.244:80/${e.data.defaultInfo.userProfilePath}`,p.classList.remove("disabled")))})),m.addEventListener("submit",(async function(t){t.preventDefault(),console.log("edit");let n,o=new FormData;if(null==y.files[0])o=null;else{if(y.files.length>1)return void alert("1개의 이미지만 선택해주세요.");if(n=y.files[0],!n.type.match("image/.*"))return void alert("jpg나 png 파일이 아닙니다.");if(n.size>1e6)return void alert("이미지의 크기가 10mb 이상입니다. ");o.append("image",y.files[0]),console.log("append")}const l={password:i.value,name:d.value,email:s.value,github:f.value,company:c.value},u={method:"PATCH",headers:{"Content-Type":"application/json","x-pocs-session-token":a},body:JSON.stringify(l)},r=await fetch(`http://34.64.170.244:80/api/users/${e}`,u),m=await r.json();if(w||null!=o){const t={method:"PATCH",headers:{"x-pocs-session-token":sessionToken},body:o};console.log(t);const a=await fetch(`http://34.64.170.244:80/api/users/${e}/profile`,t),n=await a.json();console.log(n,a)}let _=new FormData;_.append("image",g.files[0]),console.log(g.files[0]);302!==m.status||console.log(m.message),window.location.href="../html/user_detail.html?userId="+e})),l.addEventListener("click",(function(t){t.preventDefault(),window.location.href="../html/user_detail.html?userId="+e})),y.addEventListener("change",(function(e){let t=new FileReader,a=e.target.files[0];t.onload=function(e){I.src=e.target.result},t.readAsDataURL(a)})),v.addEventListener("click",(function(e){I.src="../img/logo.png",h.src!=I.src&&(w=!0)}))})();