(()=>{const n=window.location.href,t=(window.location.href,n.split("?postId="),n.split("?postId=")[1]);let e=localStorage.getItem("sessionToken"),o=localStorage.getItem("sessionToken"),s=new Headers({"x-pocs-session-token":e});const i=localStorage.getItem("userType"),l=localStorage.getItem("userId"),c=`http://34.64.170.244:80/api/comments/${t}`;async function a(n){const t=document.querySelector("#comments_count"),e=document.querySelector("#comments_div"),o=document.querySelector("#comment_input");await fetch(n,{headers:s}).then((n=>n.json())).then((n=>{if(console.log(n),t.innerHTML=`(${n.data.comments.length})`,e.innerHTML="",o.value="",0!=n.data.comments.length)for(let t=0;t<n.data.comments.length;t++)if(null!==n.data.comments[t].canceledAt){const o=n.data.comments[t].commentId;e.innerHTML+=`\n                            <div id="comment${o}" class="row p-2" >\n                                <div style="font-size: small"></div>\n                                <div class="non-hidden content d-flex justify-content-between my-2">\n                                    <div style="color:lightgray">작성자가 삭제한 댓글입니다.</div>\n                                </div>\n                                <div class="d-flex">\n                                    <div onclick="commentBtnClick(${o})">\n                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-dots-fill" viewBox="0 0 16 16">\n                                            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4.414a1 1 0 0 0-.707.293L.854 15.146A.5.5 0 0 1 0 14.793V2zm5 4a1 1 0 1 0-2 0 1 1 0 0 0 2 0zm4 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>\n                                        </svg>\n                                        <span class="reply_count">${n.data.comments[t].childrenCount||0}</span>\n                                    </div>\n                                </div>\n                                <hr>\n                                <div class="hidden reply">\n                                </div>\n                            </div>\n                    `}else if(n.data.comments[t].commentId===n.data.comments[t].parentId){const o=n.data.comments[t].commentId,s=n.data.comments[t].writer.userId;e.innerHTML+=`\n                            <div id="comment${o}" class="row p-2">\n                                <div style="font-size: small">${n.data.comments[t].writer.name||"익명"}</div>\n                                <div class="non-hidden content d-flex justify-content-between my-2">\n                                    <div>${n.data.comments[t].content}</div>\n                                    <div class="mx-5">\n                                        <button id="editDelBtn${o}" type="button" class="hidden btn btn-light" data-bs-toggle="dropdown" aria-expanded="false">\n                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">\n                                                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>\n                                            </svg>\n                                        </button>\n                                        <ul class="dropdown-menu">\n                                            <li><a class="dropdown-item" onclick="clickEditCommentBtn(${s}, ${o})">수정</a></li>\n                                            <li><a class="dropdown-item" onclick="DeleteComment(${s}, ${o})">삭제</a></li>\n                                        </ul>\n                                    </div>\n                                </div>\n                                <div class="hidden contentEdit row mb-3 my-2">\n                                    <div class="col">\n                                        <input class="editInput form-control me-2" type="text" value="${n.data.comments[t].content}" aria-label="Comment" />\n                                    </div>\n                                    <div class="col-1">\n                                        <button type="button" class="btn btn-primary w-100" onclick="EditComment(${o})">수정</button>\n                                    </div>\n                                </div>\n                                <div class="d-flex">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock me-2"  viewBox="0 0 16 16">\n                                        <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>\n                                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>\n                                    </svg>\n                                    <div class="me-3" style="font-size: smaller">${n.data.comments[t].updatedAt||n.data.comments[t].createdAt}</div>\n                                    <div onclick="commentBtnClick(${o})">\n                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-dots-fill" viewBox="0 0 16 16">\n                                            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4.414a1 1 0 0 0-.707.293L.854 15.146A.5.5 0 0 1 0 14.793V2zm5 4a1 1 0 1 0-2 0 1 1 0 0 0 2 0zm4 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>\n                                        </svg>\n                                        <span class="reply_count">${n.data.comments[t].childrenCount||0}</span>\n                                    </div>\n                                </div>\n                                <hr>\n                                <div class="hidden reply">\n                                    <div class="row mb-3 mx-1">\n                                        <div class="col">\n                                            <input class="form-control me-2 reply_input" type="text" placeholder="답글" aria-label="Comment" />\n                                        </div>\n                                        <div class="col-1">\n                                            <button type="button" class="reply_input_btn btn btn-primary w-100" onclick="AddComment(${o},'reply')">등록</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                    `,d(s,o)}else{const e=n.data.comments[t].commentId,o=n.data.comments[t].parentId,s=n.data.comments[t].writer.userId,i=document.querySelector(`#comment${o} .reply`);if(null==i)continue;i.innerHTML+=`\n                            <div id="reply${e}" class="row px-3">\n                                <div style="font-size: small">${n.data.comments[t].writer.name||"익명"}</div>\n                                <div class="non-hidden content d-flex justify-content-between my-2">\n                                    <div>${n.data.comments[t].content}</div>\n                                    <div class="mx-5">\n                                        <button id="editDelBtn${e}" type="button" class="hidden btn btn-light" data-bs-toggle="dropdown" aria-expanded="false">\n                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">\n                                                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>\n                                            </svg>\n                                        </button>\n                                        <ul class="dropdown-menu">\n                                            <li><a class="dropdown-item" onclick="clickEditCommentBtn(${s},${e},'reply')">수정</a></li>\n                                            <li><a class="dropdown-item" onclick="DeleteComment(${s}, ${e},'reply')">삭제</a></li>\n                                        </ul>\n                                    </div>\n                                </div>\n                                <div class="hidden contentEdit row mb-3 my-2">\n                                    <div class="col">\n                                        <input class="editInput form-control me-2" type="text" value="${n.data.comments[t].content}" aria-label="Comment" />\n                                    </div>\n                                    <div class="col-1">\n                                        <button type="button" class="btn btn-primary w-100" onclick="EditComment(${e},'reply')">수정</button>\n                                    </div>\n                                </div>\n                                <div class="d-flex">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock me-2"  viewBox="0 0 16 16">\n                                        <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>\n                                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>\n                                    </svg>\n                                    <div class="me-3" style="font-size: smaller">${n.data.comments[t].updatedAt||n.data.comments[t].createdAt}</div>\n                                </div>\n                                <hr>\n                            </div>\n                        `,d(s,e)}})),function(n="comment"){const t=localStorage.getItem("userType"),e=document.querySelector("#comment_input"),o=document.querySelector("#comment_input_btn"),s=document.querySelector(".reply_input"),i=document.querySelector(".reply_input_btn");if("Q/A"==document.querySelector("#title_category").innerHTML){const n=qaWriterId;if(l==n)return}"anonymous"===t&&(e.placeholder="회원만 작성할 수 있습니다.",o.classList.add("hidden"),null!=s&&(s.placeholder="회원만 작성할 수 있습니다.",i.classList.add("hidden")))}()}function d(n,t){const e=document.querySelector(`#editDelBtn${t}`);"admin"!=i&&l!=n||e.classList.replace("hidden","non-hidden")}window.AddComment=async function(n=null,e="comment"){let s;s="comment"===e?document.querySelector(`#${e}_input`):document.querySelector(`#comment${n} .${e}_input`);const i={postId:Number(t),content:s.value,parentId:n},l={method:"POST",headers:{"Content-Type":"application/json","x-pocs-session-token":o},body:JSON.stringify(i)};console.log(i);const d=await fetch("http://34.64.170.244:80/api/comments",l),m=await d.json();console.log(m),201===m.status?(alert(m.message),a(c)):alert(m.message)},window.commentBtnClick=function(n){let t=`#comment${n} .reply`,e=document.querySelector(t);"hidden"==e.classList[0]?e.classList.replace("hidden","non-hidden"):e.classList.replace("non-hidden","hidden")},window.clickEditCommentBtn=function(n,t,e="comment"){if(l==n){console.log(`#${e}${t} .content`);const n=document.querySelector(`#${e}${t} .content`),o=document.querySelector(`#${e}${t} .contentEdit`);n.classList.replace("non-hidden","hidden"),n.classList.replace("d-flex","d-flexN"),o.classList.replace("hidden","non-hidden")}else alert("댓글 작성자만 수정 가능합니다")},window.DeleteComment=async function(n,t){if("admin"===i||l===n){const n={method:"PATCH",headers:{"Content-Type":"application/json","x-pocs-session-token":o}},e=await fetch(`http://34.64.170.244:80/api/comments/${t}/delete`,n),s=await e.json();console.log(s),200===s.status?(alert(s.message),a(c)):alert(s.message)}else alert("댓글 작성자만 삭제 가능합니다")},window.EditComment=async function(n,t="comment"){const e=document.querySelector(`#${t}${n} .content`),s=document.querySelector(`#${t}${n} .contentEdit`),i={content:document.querySelector(`#${t}${n} .editInput`).value};console.log(i);const l={method:"PATCH",headers:{"Content-Type":"application/json","x-pocs-session-token":o},body:JSON.stringify(i)},d=await fetch(`http://34.64.170.244:80/api/comments/${n}`,l),m=await d.json();console.log(m),200===m.status?(e.classList.replace("hidden","non-hidden"),e.classList.replace("d-flexN","d-flex"),s.classList.replace("non-hidden","hidden"),alert(m.message),a(c)):alert(m.message)},window.setTimeout((()=>{a(c)}),200)})();